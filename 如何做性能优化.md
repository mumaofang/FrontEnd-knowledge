# 性能优化总结
做到少（请求少），小（体积小），快（加载快）三点
# 1. 网络加载优化（少）
## 减少HTTP请求
- 合并文件：合并CSS、JavaScript文件数量
- 使用雪碧图（CSS Sprite）
- 使用字体图标代替图片图标
- 内联小资源：Base64编码小图片（可在webpack文件配置中配置）
```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpe?g|gif|svg|webp)$/i,
        use: [
          {
            loader: 'url-loader',
            options: {
              // 小于 10KB 的图片转换为 base64
              limit: 10 * 1024, // 10KB
              // 超出 limit 的图片使用 file-loader
              fallback: 'file-loader',
              // 输出文件名格式
              name: 'images/[name].[hash:8].[ext]'
            }
          }
        ]
      }
    ]
  }
};
```

# 2. 减少资源体积
- 代码压缩
    - js压缩
    ```javascript
    //Webpack 5+ 使用内置的 TerserWebpackPlugin（）
    const TerserPlugin = require('terser-webpack-plugin');
    module.exports = {
        optimization: {
            minimize: true,
            minimizer: [new TerserPlugin(new TerserPlugin({
            // 配置选项
            terserOptions: {
            compress: {
                drop_console: true, // 移除 console
                drop_debugger: true, // 移除 debugger
            },
            mangle: {
                // 混淆变量名
                properties: {
                regex: /^_/ // 只混淆下划线开头的属性
                }
            },
            format: {
                comments: false, // 移除注释
            }
            },
            extractComments: false, // 不提取注释到单独文件
        }),)],
        }
    }

    // vite 配置 默认去除注释
    export default defineConfig({
    build: {
        minify: 'terser', // 可选 'esbuild'（默认，更快）或 'terser'（压缩率稍高）
        terserOptions: { // 仅在 minify: 'terser' 时生效
            compress: {
                drop_console: true, // 移除 console
                drop_debugger: true  // 移除 debugger
            }
        }
    }
    })
    ```
    
    - css压缩
    ```javascript
    // webpack
    const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
    module.exports = {
    optimization: {
        minimizer: [
        '...', // 继承默认的 minimizer（TerserPlugin）
        new CssMinimizerPlugin({
            minimizerOptions: {
            preset: [
                'default',
                {
                discardComments: { removeAll: true },
                },
            ],
            },
        }),
        ],
    },
    plugins: [
        new MiniCssExtractPlugin({
        filename: '[name].[contenthash].css',
        }),
    ],
    }
    // vite
    // 也可以使用 PostCSS 精细控制
    export default defineConfig({
    build: {
        // 默认已启用（无需显式配置）
        cssMinify: true, // Vite 4+ 新增选项，默认 true
        // 如果需要关闭 CSS 压缩（不推荐）
        // cssMinify: false
    }
    })
    ```
    
    - Gzip/Brotli压缩：
        ```javascript
        // webpack
        const CompressionPlugin = require('compression-webpack-plugin');
        module.exports = {
        plugins: [
            // Gzip 压缩
            new CompressionPlugin({
                filename: '[path][base].gz',
                algorithm: 'gzip',
                test: /\.(js|css|html|svg|json)$/,
                include: /\/src\//, // 只压缩 src 目录下的文件
                exclude: /\.map$/,  // 排除 source map
                threshold: 10240,   // 10KB 以上才压缩
                minRatio: 0.8,      // 压缩率小于 0.8 才输出
                compressionOptions: { level: 9 }, // 压缩级别 1-9
                deleteOriginalAssets: false,
            }),
            // Brotli 压缩（更高效）
            new CompressionPlugin({
                filename: '[path][base].br',
                algorithm: 'brotliCompress',
                test: /\.(js|css|html|svg|json)$/,
                compressionOptions: {
                    level: 11, // Brotli 压缩级别 0-11
                },
                threshold: 10240,
                minRatio: 0.8,
                deleteOriginalAssets: false,
            }),
        ],
        };
        // vite 
        import viteCompression from 'vite-plugin-compression'
        import { zlib } from 'node:zlib'

        export default defineConfig({
        plugins: [
            // Gzip 压缩
            viteCompression({
            algorithm: 'gzip',
            ext: '.gz',
            threshold: 10240,
            compressionOptions: {
                level: 9 // 最高压缩比
            }
            }),
            
            // Brotli 压缩（更高压缩率，现代浏览器支持）
            viteCompression({
            algorithm: 'brotliCompress',
            ext: '.br',
            threshold: 10240,
            compressionOptions: {
                params: {
                [zlib.constants.BROTLI_PARAM_QUALITY]: 11, // 质量 1-11
                [zlib.constants.BROTLI_PARAM_MODE]: zlib.constants.BROTLI_MODE_TEXT
                }
            },
            filter: /\.(js|mjs|css|html|svg|json)$/i // 更严格的文件过滤
            })
        ]
        })
        ```
        # Nginx配置
        gzip on;
        gzip_comp_level 6;
        brotli on;
        brotli_comp_level 6;

# 3. 缓存优化
        - 图片优化：
        使用WebP格式
        响应式图片（srcset）
        懒加载
    强缓存 nginx
    location /static {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    协商缓存：ETag/Last-Modified
    Service Worker缓存
# 4. 代码执行优化
    JavaScript优化
        减少重绘重排：
            避免频繁修改dom, 批量修改dom。
            最小变动原则，

        防抖节流：
    CSS优化
        避免使用@import
        减少选择器复杂度
        使用transform和opacity（触发GPU加速）
# 5. 框架优化
    代码分割
# 6. 渲染优化
     关键渲染路径优化
        CSS放头部，JS放底部
        异步加载非关键资源：
# 7. 构建工具优化
    代码分割
    // webpack.config.js
    module.exports = {
        optimization: {
            splitChunks: {
            chunks: 'all',
            cacheGroups: {
                vendors: {
                test: /[\\/]node_modules[\\/]/,
                name: 'vendors',
                },
            },
            },
        },
    };
    Tree Shaking
        // package.json
        {
            "sideEffects": false
        }
    持久化缓存
        module.exports = {
            cache: {
                type: 'filesystem',
            },
        };
 
